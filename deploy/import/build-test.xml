<?xml version="1.0" encoding="UTF-8"?>
<project name="Test" basedir="/var/www/html">
    <property name="bin.phpunit" value="phpunit"/>
    <property name="bin.phpmd" value="phpmd"/>

    <target name="validate-phpunit-properties" description="Ensure phpunit properties">
        <if>
            <not>
                <isset property="phpunit.filename"/>
            </not>
            <then>
                <fail>phpunit.filename is not specified</fail>
            </then>
        </if>
        <echo message="Done"/>
    </target>
    <target name="validate-phpunit-version" description="Ensure phpunit version">
        <exec command="${bin.phpunit} --version" passthru="true" checkreturn="true"/>
    </target>
    <target name="test-phpunit"
            depends="validate-phpunit-properties, validate-phpunit-version"
            description="Test phpunit">
        <exec command="${bin.phpunit} -c ${phpunit.filename}" passthru="true" checkreturn="true"/>
    </target>

    <target name="validate-phpmd-properties" description="Ensure phpmd properties">
        <if>
            <not>
                <isset property="phpmd.source_dirs"/>
            </not>
            <then>
                <fail>phpmd.source_dirs is not specified</fail>
            </then>
        </if>
        <if>
            <not>
                <isset property="phpmd.format"/>
            </not>
            <then>
                <fail>phpmd.format is not specified</fail>
            </then>
        </if>
        <if>
            <not>
                <isset property="phpmd.rulesets"/>
            </not>
            <then>
                <fail>phpmd.rulesets is not specified</fail>
            </then>
        </if>
        <if>
            <not>
                <isset property="phpmd.suffixes"/>
            </not>
            <then>
                <fail>phpmd.suffixes is not specified</fail>
            </then>
        </if>
        <echo message="Done"/>
    </target>
    <target name="validate-phpmd-version" description="Ensure phpmd version">
        <exec command="${bin.phpmd} --version"
              passthru="true"
              checkreturn="true"/>
    </target>
    <target name="test-phpmd"
            depends="validate-phpmd-version"
            description="Test phpmd">
        <exec command="${bin.phpmd} ${phpmd.source_dirs} ${phpmd.format} ${phpmd.rulesets} --suffixes='${phpmd.suffixes}'"
              passthru="true"
              checkreturn="true"/>
    </target>

    <target name="test-all"
            depends="test-phpmd, test-phpunit"
            description="Test all">
        <echo message="Done"/>
    </target>
</project>
